---

- name: Deploy common to all hosts
  hosts: all
  become: true
  roles:
    - common
  tasks:
    - name: Set MOTD banner
      ansible.builtin.include_tasks: tasks/banner.yml
    - name: Deploy extra packages as per host_vars
      ansible.builtin.include_tasks: tasks/extra_packages.yml
  tags: common

- name: Deploy Secure Boot to workstations
  hosts: workstations
  become: true
  tasks:
    - name: Deploy Secure Boot
      ansible.builtin.include_tasks: tasks/secureboot.yml
  tags: secureboot

- name: Set up VFIO on workstations
  hosts: workstations
  become: true
  tasks:
    - name: Deploy VFIO
      ansible.builtin.include_tasks: tasks/vfio.yml
  tags: vfio

- name: Deploy cups to workstations
  hosts: workstations
  become: true
  tasks:
    - name: Deploy cups
      ansible.builtin.include_tasks: tasks/cups.yml
  tags: cups

- name: Set up backlight configuration to shale
  hosts: shale
  become: true
  tasks:
    - name: Set up backlight
      ansible.builtin.include_tasks: tasks/backlight.yml
  tags: backlight

- name: Deploy custom drivers to slate
  hosts: slate
  become: true
  tasks:
    - name: Deploy RTL8821ce wireless network driver
      ansible.builtin.include_tasks: tasks/rtl8821ce.yml
  tags: driver

- name: Deploy VPN to galena and slate
  hosts: galena slate
  become: true
  roles:
    - wireguard
  tags: vpn

- name: Deploy reverse proxy to galena
  hosts: galena
  become: true
  roles:
    - nginx
    - certbot
  tags: proxy

- name: Deploy DNS to galena
  hosts: galena
  become: true
  roles:
    - pihole
  tags: dns

- name: Deploy web server to gabbro
  hosts: gabbro
  become: true
  roles:
    - nginx
  tasks:
    - name: Deploy zaszi.net website
      ansible.builtin.include_tasks: tasks/zaszi-web.yml
  tags: web

- name: Deploy Home Assistant additions to other hosts
  hosts: shale
  become: true
  tasks:
    - name: Deploy Home Assistant user for remote shutdown
      ansible.builtin.include_tasks: tasks/hass.yml
  tags: hass

- name: Deploy dotfiles to all hosts
  hosts: all
  become: false
  roles:
    - dotfiles
  tags: dotfiles
